<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finger Counting Fun</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&amp;family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Fredoka', 'Nunito', sans-serif;
    }
    @keyframes bounce-in {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.08); }
      70% { transform: scale(0.92); }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(-4deg); }
      25% { transform: rotate(4deg); }
      50% { transform: rotate(-4deg); }
      75% { transform: rotate(4deg); }
    }
    @keyframes pop {
      0% { transform: scale(1); }
      40% { transform: scale(1.15); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-8px) rotate(-2deg); }
      50% { transform: translateY(-12px) rotate(0deg); }
      75% { transform: translateY(-8px) rotate(2deg); }
    }
    @keyframes confetti-fall {
      0% { 
        transform: translateY(-150%) rotate(0deg) scale(1); 
        opacity: 1; 
      }
      50% {
        opacity: 1;
      }
      100% { 
        transform: translateY(120vh) rotate(720deg) scale(0.8); 
        opacity: 0; 
      }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10% { transform: translateX(-8px) rotate(-2deg); }
      30% { transform: translateX(8px) rotate(2deg); }
      50% { transform: translateX(-8px) rotate(-1deg); }
      70% { transform: translateX(8px) rotate(1deg); }
      90% { transform: translateX(-4px); }
    }
    @keyframes pulse-glow {
      0%, 100% { 
        box-shadow: 0 0 25px rgba(251, 146, 60, 0.5), 0 0 50px rgba(251, 146, 60, 0.3); 
      }
      50% { 
        box-shadow: 0 0 40px rgba(251, 146, 60, 0.8), 0 0 80px rgba(251, 146, 60, 0.5); 
      }
    }
    @keyframes sparkle {
      0%, 100% { opacity: 0.4; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    @keyframes timer-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .bounce-in { animation: bounce-in 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
    .wiggle { animation: wiggle 0.6s ease-in-out; }
    .pop { animation: pop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
    .float { animation: float 4s ease-in-out infinite; }
    .shake { animation: shake 0.6s ease-in-out; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    .timer-pulse { animation: timer-pulse 0.5s ease-in-out; }
    .confetti {
      position: absolute;
      animation: confetti-fall 2s ease-out forwards;
    }
    .btn-option {
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      position: relative;
      overflow: hidden;
    }
    .btn-option::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .btn-option:active::before {
      width: 300px;
      height: 300px;
    }
    .btn-option:hover {
      transform: translateY(-6px) scale(1.03);
      filter: brightness(1.1);
    }
    .btn-option:active {
      transform: scale(0.95);
    }
    .hand-container {
      filter: drop-shadow(4px 8px 12px rgba(0,0,0,0.15));
    }
    .timer-bar {
      transition: width 1s linear, background-color 0.3s ease;
    }
    .score-badge {
      transition: all 0.3s ease;
    }
    .score-badge:hover {
      transform: scale(1.1) rotate(-5deg);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full overflow-auto"><!-- Main Game Container -->
   <div class="min-h-full p-4 md:p-6"><!-- Desktop Horizontal Layout (landscape) -->
    <div class="hidden lg:flex h-full items-center justify-center gap-8"><!-- Left Section: Game Info & Controls -->
     <div class="flex flex-col items-center gap-6 w-1/3 max-w-md"><!-- Header -->
      <div class="text-center">
       <h1 id="game-title-desktop" class="text-4xl xl:text-5xl font-extrabold mb-3 drop-shadow-lg">üñêÔ∏è Finger Counting Fun! üñêÔ∏è</h1>
       <p id="subtitle-desktop" class="text-xl xl:text-2xl font-semibold">How many fingers do you see?</p>
      </div><!-- Score & Timer Section -->
      <div class="w-full">
       <div class="flex justify-between items-center mb-3">
        <div class="score-badge flex items-center gap-2 px-4 py-3 rounded-full shadow-lg border-4"><span class="text-2xl sparkle">‚≠ê</span>
         <div class="flex flex-col"><span class="text-xs font-semibold opacity-75">Score</span> <span id="score-desktop" class="text-2xl font-extrabold">0</span>
         </div>
        </div>
        <div class="score-badge flex items-center gap-2 px-4 py-3 rounded-full shadow-lg border-4"><span class="text-2xl sparkle">üî•</span>
         <div class="flex flex-col"><span class="text-xs font-semibold opacity-75">Streak</span> <span id="streak-desktop" class="text-2xl font-extrabold">0</span>
         </div>
        </div>
       </div><!-- Timer Bar -->
       <div class="w-full h-5 rounded-full overflow-hidden shadow-inner border-3" id="timer-container-desktop">
        <div id="timer-bar-desktop" class="timer-bar h-full rounded-full relative" style="width: 100%">
         <div class="absolute inset-0 bg-white opacity-20"></div>
        </div>
       </div>
       <p id="timer-text-desktop" class="text-center text-base font-bold mt-2">‚è±Ô∏è <span id="time-remaining-desktop">15</span>s</p>
      </div><!-- Feedback Area -->
      <div id="feedback-desktop" class="h-24 flex items-center justify-center w-full"><!-- Feedback messages appear here -->
      </div><!-- Answer Options -->
      <div id="options-container-desktop" class="grid grid-cols-2 gap-4 w-full"><!-- Options will be inserted here -->
      </div><!-- Next Button --> <button id="next-btn-desktop" class="px-8 py-4 rounded-full text-xl font-extrabold shadow-2xl transform transition-all duration-300 border-4 hover:scale-110 active:scale-95 hidden"> Next Question ‚û°Ô∏è </button>
     </div><!-- Right Section: Hands Display -->
     <div class="flex items-center justify-center w-2/3">
      <div id="hands-container-desktop" class="hand-container rounded-3xl p-12 shadow-2xl border-4 border-dashed float mx-auto">
       <div id="hands-display-desktop" class="flex justify-center items-center gap-32 xl:gap-48 min-h-[200px]"><!-- Hands will be inserted here -->
       </div>
      </div>
     </div>
    </div><!-- Mobile/Tablet Vertical Layout -->
    <div class="flex flex-col items-center lg:hidden"><!-- Header -->
     <div class="text-center mb-4">
      <h1 id="game-title" class="text-4xl md:text-5xl font-extrabold mb-3 drop-shadow-lg">üñêÔ∏è Finger Counting Fun! üñêÔ∏è</h1>
      <p id="subtitle" class="text-xl md:text-2xl font-semibold">How many fingers do you see?</p>
     </div><!-- Score & Timer Section -->
     <div class="w-full max-w-md mb-5">
      <div class="flex justify-between items-center mb-3">
       <div class="score-badge flex items-center gap-2 px-5 py-3 rounded-full shadow-lg border-4"><span class="text-2xl sparkle">‚≠ê</span>
        <div class="flex flex-col"><span class="text-xs font-semibold opacity-75">Score</span> <span id="score" class="text-2xl font-extrabold">0</span>
        </div>
       </div>
       <div class="score-badge flex items-center gap-2 px-5 py-3 rounded-full shadow-lg border-4"><span class="text-2xl sparkle">üî•</span>
        <div class="flex flex-col"><span class="text-xs font-semibold opacity-75">Streak</span> <span id="streak" class="text-2xl font-extrabold">0</span>
        </div>
       </div>
      </div><!-- Timer Bar -->
      <div class="w-full h-5 rounded-full overflow-hidden shadow-inner border-3" id="timer-container">
       <div id="timer-bar" class="timer-bar h-full rounded-full relative" style="width: 100%">
        <div class="absolute inset-0 bg-white opacity-20"></div>
       </div>
      </div>
      <p id="timer-text" class="text-center text-base font-bold mt-2">‚è±Ô∏è <span id="time-remaining">15</span>s</p>
     </div><!-- Hands Display Area -->
     <div id="hands-container" class="hand-container rounded-3xl p-8 md:p-10 mb-6 shadow-2xl border-4 border-dashed float mx-auto">
      <div id="hands-display" class="flex justify-center items-center gap-32 md:gap-48 min-h-[200px]"><!-- Hands will be inserted here -->
      </div>
     </div><!-- Feedback Area -->
     <div id="feedback" class="h-20 flex items-center justify-center mb-5"><!-- Feedback messages appear here -->
     </div><!-- Answer Options -->
     <div id="options-container" class="grid grid-cols-2 gap-4 md:gap-5 w-full max-w-lg mb-6"><!-- Options will be inserted here -->
     </div><!-- Next Button --> <button id="next-btn" class="px-10 py-5 rounded-full text-2xl font-extrabold shadow-2xl transform transition-all duration-300 border-4 hover:scale-110 active:scale-95 hidden"> Next Question ‚û°Ô∏è </button>
    </div><!-- Confetti Container -->
    <div id="confetti-container" class="fixed inset-0 pointer-events-none overflow-hidden" style="z-index: 9999;"></div>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      game_title: "üñêÔ∏è Finger Counting Fun! üñêÔ∏è",
      correct_message: "Great job!",
      wrong_message: "Try again!",
      background_color: "#FEF3C7",
      surface_color: "#FFFFFF",
      text_color: "#78350F",
      primary_action_color: "#FB923C",
      secondary_action_color: "#10B981"
    };

    // Game state
    let currentNumber = 1;
    let score = 0;
    let streak = 0;
    let answered = false;
    let timerInterval = null;
    let timeLeft = 15;
    const TIMER_DURATION = 15;
    let questionCount = 0;
    const MAX_QUESTIONS = 20;
    let correctAnswers = 0;
    let incorrectAnswers = 0;
    
    // Advanced randomness system - prevents repetition
    let recentNumbers = [];
    const HISTORY_SIZE = 8; // Prevent repetition until 8 different numbers used

    // Number words
    const numberWords = ['one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten'];
    
    // Sound effects using Web Audio API
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    function playCorrectSound() {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
      oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
      oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }
    
    function playIncorrectSound() {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.15);
      
      gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }
    
    // Check if desktop layout
    function isDesktop() {
      return window.innerWidth >= 1024;
    }

    // Fisher-Yates shuffle algorithm
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // Get random number without recent repetitions
    function getRandomNumber() {
      let availableNumbers = [];
      for (let i = 1; i <= 10; i++) {
        if (!recentNumbers.includes(i)) {
          availableNumbers.push(i);
        }
      }
      
      // If we've used too many numbers, clear some history
      if (availableNumbers.length === 0) {
        recentNumbers = recentNumbers.slice(-3);
        availableNumbers = [];
        for (let i = 1; i <= 10; i++) {
          if (!recentNumbers.includes(i)) {
            availableNumbers.push(i);
          }
        }
      }
      
      const randomNum = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
      recentNumbers.push(randomNum);
      
      if (recentNumbers.length > HISTORY_SIZE) {
        recentNumbers.shift();
      }
      
      return randomNum;
    }

    // Enhanced SVG Hand Generator with realistic fingers
    function generateHandSVG(fingers, isLeft = false) {
      const width = 140;
      const height = 180;
      
      // Finger configurations
      const fingerConfigs = {
        1: [false, true, false, false, false],
        2: [false, true, true, false, false],
        3: [false, true, true, true, false],
        4: [false, true, true, true, true],
        5: [true, true, true, true, true],
      };

      const config = fingerConfigs[fingers] || [false, false, false, false, false];
      const [thumb, index, middle, ring, pinky] = config;

      const transform = isLeft ? `transform="scale(-1, 1) translate(-${width}, 0)"` : '';
      
      // Colors
      const activeColor = '#FB923C'; // Vibrant orange
      const inactiveColor = '#FEF3C7'; // Light yellow
      const outlineColor = '#78350F'; // Brown
      const highlightColor = '#EF4444'; // Red indicator

      return `
        <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" ${transform}>
          <defs>
            <filter id="shadow">
              <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.3"/>
            </filter>
            <linearGradient id="palmGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:1" />
            </linearGradient>
          </defs>
          
          <!-- Palm with gradient -->
          <ellipse cx="70" cy="130" rx="50" ry="40" fill="url(#palmGradient)" stroke="${outlineColor}" stroke-width="3.5" filter="url(#shadow)"/>
          
          <!-- Palm details -->
          <path d="M 50 125 Q 55 130 50 135" stroke="${outlineColor}" stroke-width="1.5" fill="none" opacity="0.3"/>
          <path d="M 65 120 Q 70 128 65 136" stroke="${outlineColor}" stroke-width="1.5" fill="none" opacity="0.3"/>
          <path d="M 80 120 Q 85 128 80 136" stroke="${outlineColor}" stroke-width="1.5" fill="none" opacity="0.3"/>
          
          <!-- Wrist -->
          <rect x="40" y="155" width="60" height="30" rx="8" fill="url(#palmGradient)" stroke="${outlineColor}" stroke-width="3.5" filter="url(#shadow)"/>
          
          <!-- Thumb (shorter, thicker) -->
          <g opacity="${thumb ? '1' : '0.35'}">
            <!-- Thumb metacarpal -->
            <ellipse cx="28" cy="115" rx="14" ry="18" fill="${thumb ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" transform="rotate(-25, 28, 115)" filter="url(#shadow)"/>
            <!-- Thumb proximal phalanx -->
            <ellipse cx="22" cy="95" rx="13" ry="20" fill="${thumb ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" transform="rotate(-30, 22, 95)" filter="url(#shadow)"/>
            <!-- Thumb distal phalanx -->
            <ellipse cx="18" cy="75" rx="11" ry="16" fill="${thumb ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" transform="rotate(-30, 18, 75)" filter="url(#shadow)"/>
            ${thumb ? `<circle cx="16" cy="65" r="4" fill="${highlightColor}" opacity="0.9"/>` : ''}
            ${thumb ? '<ellipse cx="18" cy="68" rx="6" ry="4" fill="white" opacity="0.4"/>' : ''}
          </g>
          
          <!-- Index Finger -->
          <g opacity="${index ? '1' : '0.35'}">
            <!-- Proximal phalanx -->
            <rect x="38" y="70" width="18" height="35" rx="9" fill="${index ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Middle phalanx -->
            <rect x="39" y="45" width="16" height="28" rx="8" fill="${index ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Distal phalanx -->
            <ellipse cx="47" cy="32" rx="8" ry="14" fill="${index ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            ${index ? `<circle cx="47" cy="22" r="4" fill="${highlightColor}" opacity="0.9"/>` : ''}
            ${index ? '<ellipse cx="47" cy="25" rx="5" ry="3" fill="white" opacity="0.4"/>' : ''}
          </g>
          
          <!-- Middle Finger (tallest) -->
          <g opacity="${middle ? '1' : '0.35'}">
            <!-- Proximal phalanx -->
            <rect x="60" y="65" width="18" height="40" rx="9" fill="${middle ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Middle phalanx -->
            <rect x="61" y="35" width="16" height="33" rx="8" fill="${middle ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Distal phalanx -->
            <ellipse cx="69" cy="20" rx="8" ry="16" fill="${middle ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            ${middle ? `<circle cx="69" cy="10" r="4" fill="${highlightColor}" opacity="0.9"/>` : ''}
            ${middle ? '<ellipse cx="69" cy="13" rx="5" ry="3" fill="white" opacity="0.4"/>' : ''}
          </g>
          
          <!-- Ring Finger -->
          <g opacity="${ring ? '1' : '0.35'}">
            <!-- Proximal phalanx -->
            <rect x="82" y="70" width="18" height="35" rx="9" fill="${ring ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Middle phalanx -->
            <rect x="83" y="45" width="16" height="28" rx="8" fill="${ring ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Distal phalanx -->
            <ellipse cx="91" cy="32" rx="8" ry="14" fill="${ring ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            ${ring ? `<circle cx="91" cy="22" r="4" fill="${highlightColor}" opacity="0.9"/>` : ''}
            ${ring ? '<ellipse cx="91" cy="25" rx="5" ry="3" fill="white" opacity="0.4"/>' : ''}
          </g>
          
          <!-- Pinky Finger (shortest, thinnest) -->
          <g opacity="${pinky ? '1' : '0.35'}">
            <!-- Proximal phalanx -->
            <rect x="104" y="85" width="16" height="28" rx="8" fill="${pinky ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Middle phalanx -->
            <rect x="105" y="65" width="14" height="22" rx="7" fill="${pinky ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            <!-- Distal phalanx -->
            <ellipse cx="112" cy="54" rx="7" ry="12" fill="${pinky ? activeColor : inactiveColor}" stroke="${outlineColor}" stroke-width="3" filter="url(#shadow)"/>
            ${pinky ? `<circle cx="112" cy="46" r="3.5" fill="${highlightColor}" opacity="0.9"/>` : ''}
            ${pinky ? '<ellipse cx="112" cy="48" rx="4" ry="2.5" fill="white" opacity="0.4"/>' : ''}
          </g>
        </svg>
      `;
    }

    // Generate hands for a number
    function generateHandsForNumber(num) {
      const desktop = isDesktop();
      const container = document.getElementById(desktop ? 'hands-display-desktop' : 'hands-display');
      container.innerHTML = '';
      container.className = 'flex justify-center items-center gap-32 md:gap-48 min-h-[200px] bounce-in';

      if (num <= 5) {
        const handDiv = document.createElement('div');
        handDiv.innerHTML = generateHandSVG(num, false);
        container.appendChild(handDiv);
      } else {
        const leftFingers = 5;
        const rightFingers = num - 5;
        
        const leftHandDiv = document.createElement('div');
        leftHandDiv.innerHTML = generateHandSVG(leftFingers, true);
        container.appendChild(leftHandDiv);
        
        const rightHandDiv = document.createElement('div');
        rightHandDiv.innerHTML = generateHandSVG(rightFingers, false);
        container.appendChild(rightHandDiv);
      }
    }

    // Generate UNIQUE answer options with improved distribution
    function generateOptions(correctNum) {
      const options = new Set([correctNum]);
      
      // Create pool of all other numbers
      const allNumbers = [];
      for (let i = 1; i <= 10; i++) {
        if (i !== correctNum) {
          allNumbers.push(i);
        }
      }
      
      // Shuffle and take first 3
      const shuffled = shuffleArray(allNumbers);
      for (let i = 0; i < 3 && i < shuffled.length; i++) {
        options.add(shuffled[i]);
      }
      
      // Ensure we have exactly 4 unique options
      return shuffleArray(Array.from(options));
    }

    // Render options with enhanced colors
    function renderOptions(options, config) {
      const desktop = isDesktop();
      const container = document.getElementById(desktop ? 'options-container-desktop' : 'options-container');
      container.innerHTML = '';
      
      const colors = [
        { bg: '#FEE2E2', border: '#F87171', hover: '#FECACA', shadow: 'rgba(248, 113, 113, 0.4)' },
        { bg: '#DBEAFE', border: '#60A5FA', hover: '#BFDBFE', shadow: 'rgba(96, 165, 250, 0.4)' },
        { bg: '#D1FAE5', border: '#34D399', hover: '#A7F3D0', shadow: 'rgba(52, 211, 153, 0.4)' },
        { bg: '#FEF3C7', border: '#FBBF24', hover: '#FDE68A', shadow: 'rgba(251, 191, 36, 0.4)' }
      ];
      
      options.forEach((num, i) => {
        const btn = document.createElement('button');
        btn.className = `btn-option py-5 px-6 rounded-3xl ${desktop ? 'text-2xl' : 'text-3xl'} font-extrabold shadow-xl border-4 relative`;
        btn.style.backgroundColor = colors[i].bg;
        btn.style.borderColor = colors[i].border;
        btn.style.color = config.text_color || defaultConfig.text_color;
        btn.style.boxShadow = `0 8px 16px ${colors[i].shadow}`;
        btn.textContent = numberWords[num - 1].toUpperCase();
        btn.dataset.number = num;
        btn.disabled = answered;
        
        btn.addEventListener('click', () => handleAnswer(num, btn, config));
        btn.addEventListener('mouseenter', () => {
          if (!answered) {
            btn.style.backgroundColor = colors[i].hover;
            btn.style.transform = 'translateY(-6px) scale(1.03)';
          }
        });
        btn.addEventListener('mouseleave', () => {
          if (!answered) {
            btn.style.backgroundColor = colors[i].bg;
            btn.style.transform = '';
          }
        });
        
        container.appendChild(btn);
      });
    }

    // Enhanced answer handling with better feedback
    function handleAnswer(selectedNum, btn, config) {
      if (answered) return;
      answered = true;
      stopTimer();
      
      const desktop = isDesktop();
      const feedbackEl = document.getElementById(desktop ? 'feedback-desktop' : 'feedback');
      const nextBtn = document.getElementById(desktop ? 'next-btn-desktop' : 'next-btn');
      const scoreEl = document.getElementById(desktop ? 'score-desktop' : 'score');
      const streakEl = document.getElementById(desktop ? 'streak-desktop' : 'streak');
      const optionsContainer = desktop ? 'options-container-desktop' : 'options-container';
      
      const isCorrect = selectedNum === currentNumber;
      
      // Disable all buttons and highlight correct answer
      document.querySelectorAll(`#${optionsContainer} button`).forEach(b => {
        b.disabled = true;
        if (parseInt(b.dataset.number) === currentNumber) {
          b.style.backgroundColor = '#86EFAC';
          b.style.borderColor = '#22C55E';
          b.style.boxShadow = '0 0 30px rgba(34, 197, 94, 0.6)';
          b.classList.add('pop');
        }
      });
      
      if (isCorrect) {
        playCorrectSound();
        correctAnswers++;
        
        const timeBonus = Math.floor(timeLeft * 2);
        const streakBonus = streak * 5;
        const totalPoints = 10 + timeBonus + streakBonus;
        score += totalPoints;
        streak++;
        
        scoreEl.textContent = score;
        scoreEl.classList.add('pop');
        streakEl.textContent = streak;
        streakEl.classList.add('pop');
        
        btn.style.backgroundColor = '#86EFAC';
        btn.style.borderColor = '#22C55E';
        btn.style.boxShadow = '0 0 40px rgba(34, 197, 94, 0.8)';
        
        feedbackEl.innerHTML = `
          <div class="flex flex-col items-center gap-2 text-center bounce-in">
            <div class="flex items-center gap-3 ${desktop ? 'text-2xl' : 'text-3xl'} font-extrabold text-green-600">
              <span class="text-5xl">‚úÖ</span>
              <span>${config.correct_message || defaultConfig.correct_message}</span>
              <span class="text-5xl">üéâ</span>
            </div>
            <div class="${desktop ? 'text-base' : 'text-lg'} font-bold text-green-700">
              +${totalPoints} points! 
              ${streak > 1 ? `üî• ${streak} streak!` : ''}
            </div>
          </div>
        `;
        
        createEnhancedConfetti();
      } else {
        playIncorrectSound();
        incorrectAnswers++;
        
        streak = 0;
        streakEl.textContent = streak;
        streakEl.classList.add('shake');
        
        btn.style.backgroundColor = '#FCA5A5';
        btn.style.borderColor = '#EF4444';
        btn.style.boxShadow = '0 0 30px rgba(239, 68, 68, 0.6)';
        btn.classList.add('shake');
        
        feedbackEl.innerHTML = `
          <div class="flex flex-col items-center gap-2 text-center bounce-in">
            <div class="flex items-center gap-3 ${desktop ? 'text-2xl' : 'text-3xl'} font-extrabold text-red-600">
              <span class="text-5xl">‚ùå</span>
              <span>${config.wrong_message || defaultConfig.wrong_message}</span>
            </div>
            <div class="${desktop ? 'text-lg' : 'text-xl'} font-bold text-red-700">
              The answer was <span class="text-2xl">${numberWords[currentNumber - 1].toUpperCase()}</span>
            </div>
          </div>
        `;
      }
      
      // Check if game is over
      if (questionCount >= MAX_QUESTIONS) {
        setTimeout(() => showFinalScore(config), 1500);
      } else {
        nextBtn.classList.remove('hidden');
        nextBtn.classList.add('bounce-in', 'pulse-glow');
      }
    }

    // Enhanced timer with visual countdown
    function startTimer() {
      timeLeft = TIMER_DURATION;
      const desktop = isDesktop();
      const timerBar = document.getElementById(desktop ? 'timer-bar-desktop' : 'timer-bar');
      const timeDisplay = document.getElementById(desktop ? 'time-remaining-desktop' : 'time-remaining');
      timerBar.style.width = '100%';
      timerBar.style.backgroundColor = '#22C55E';
      timeDisplay.textContent = timeLeft;
      
      timerInterval = setInterval(() => {
        timeLeft--;
        timeDisplay.textContent = timeLeft;
        const percentage = (timeLeft / TIMER_DURATION) * 100;
        timerBar.style.width = `${percentage}%`;
        
        if (timeLeft <= 3) {
          timerBar.style.backgroundColor = '#EF4444';
          timerBar.classList.add('timer-pulse');
        } else if (timeLeft <= 7) {
          timerBar.style.backgroundColor = '#F59E0B';
        } else if (timeLeft <= 10) {
          timerBar.style.backgroundColor = '#FBBF24';
        }
        
        if (timeLeft <= 0) {
          stopTimer();
          if (!answered) {
            handleTimeUp();
          }
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      const desktop = isDesktop();
      const timerBar = document.getElementById(desktop ? 'timer-bar-desktop' : 'timer-bar');
      timerBar.classList.remove('timer-pulse');
    }

    function handleTimeUp() {
      answered = true;
      playIncorrectSound();
      incorrectAnswers++;
      
      const config = window.elementSdk?.config || defaultConfig;
      const desktop = isDesktop();
      const feedbackEl = document.getElementById(desktop ? 'feedback-desktop' : 'feedback');
      const nextBtn = document.getElementById(desktop ? 'next-btn-desktop' : 'next-btn');
      const streakEl = document.getElementById(desktop ? 'streak-desktop' : 'streak');
      const optionsContainer = desktop ? 'options-container-desktop' : 'options-container';
      
      streak = 0;
      streakEl.textContent = streak;
      streakEl.classList.add('shake');
      
      document.querySelectorAll(`#${optionsContainer} button`).forEach(b => {
        b.disabled = true;
        if (parseInt(b.dataset.number) === currentNumber) {
          b.style.backgroundColor = '#86EFAC';
          b.style.borderColor = '#22C55E';
          b.style.boxShadow = '0 0 30px rgba(34, 197, 94, 0.6)';
          b.classList.add('pop');
        }
      });
      
      feedbackEl.innerHTML = `
        <div class="flex flex-col items-center gap-2 text-center bounce-in">
          <div class="flex items-center gap-3 ${desktop ? 'text-2xl' : 'text-3xl'} font-extrabold text-orange-600">
            <span class="text-5xl">‚è∞</span>
            <span>Time's up!</span>
          </div>
          <div class="${desktop ? 'text-lg' : 'text-xl'} font-bold text-orange-700">
            The answer was <span class="text-2xl">${numberWords[currentNumber - 1].toUpperCase()}</span>
          </div>
        </div>
      `;
      
      // Check if game is over
      if (questionCount >= MAX_QUESTIONS) {
        setTimeout(() => showFinalScore(config), 1500);
      } else {
        nextBtn.classList.remove('hidden');
        nextBtn.classList.add('bounce-in', 'pulse-glow');
      }
    }

    // Show final score screen
    function showFinalScore(config) {
      const desktop = isDesktop();
      const appContainer = document.getElementById('app');
      
      const percentage = Math.round((correctAnswers / MAX_QUESTIONS) * 100);
      let message = '';
      let emoji = '';
      
      if (percentage >= 90) {
        message = '¬°Excelente trabajo!';
        emoji = 'üèÜ';
      } else if (percentage >= 70) {
        message = '¬°Muy bien!';
        emoji = '‚≠ê';
      } else if (percentage >= 50) {
        message = '¬°Buen intento!';
        emoji = 'üëç';
      } else {
        message = '¬°Sigue practicando!';
        emoji = 'üí™';
      }
      
      // Mantener el color de fondo
      appContainer.style.backgroundColor = config.background_color || defaultConfig.background_color;
      
      appContainer.innerHTML = `
        <div class="h-full flex items-center justify-center p-6">
          <div class="text-center max-w-2xl mx-auto bounce-in">
            <div class="text-8xl mb-6">${emoji}</div>
            <h1 class="text-5xl md:text-6xl font-extrabold mb-4" style="color: ${config.text_color || defaultConfig.text_color}">
              ¬°Juego Terminado!
            </h1>
            <h2 class="text-3xl md:text-4xl font-bold mb-8" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}">
              ${message}
            </h2>
            
            <div class="rounded-3xl p-8 mb-8 shadow-2xl border-4" style="background-color: ${config.surface_color || defaultConfig.surface_color}; border-color: ${config.primary_action_color || defaultConfig.primary_action_color}">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                  <div class="text-6xl font-extrabold mb-2" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}">${score}</div>
                  <div class="text-xl font-semibold" style="color: ${config.text_color || defaultConfig.text_color}">Puntos Totales</div>
                </div>
                <div class="text-center">
                  <div class="text-6xl font-extrabold mb-2 text-green-600">${correctAnswers}</div>
                  <div class="text-xl font-semibold" style="color: ${config.text_color || defaultConfig.text_color}">Correctas ‚úÖ</div>
                </div>
                <div class="text-center">
                  <div class="text-6xl font-extrabold mb-2 text-red-600">${incorrectAnswers}</div>
                  <div class="text-xl font-semibold" style="color: ${config.text_color || defaultConfig.text_color}">Incorrectas ‚ùå</div>
                </div>
              </div>
              
              <div class="mt-6 pt-6 border-t-4" style="border-color: ${config.primary_action_color || defaultConfig.primary_action_color}">
                <div class="text-5xl font-extrabold mb-2" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}">${percentage}%</div>
                <div class="text-xl font-semibold" style="color: ${config.text_color || defaultConfig.text_color}">Precisi√≥n</div>
              </div>
            </div>
            
            <button id="restart-btn" class="px-12 py-6 rounded-full text-3xl font-extrabold shadow-2xl transform transition-all duration-300 border-4 hover:scale-110 active:scale-95" style="background-color: ${config.primary_action_color || defaultConfig.primary_action_color}; color: ${config.surface_color || defaultConfig.surface_color}; border-color: ${config.text_color || defaultConfig.text_color}">
              üîÑ Jugar de Nuevo
            </button>
          </div>
        </div>
      `;
      
      // Add restart functionality
      document.getElementById('restart-btn').addEventListener('click', () => {
        location.reload();
      });
      
      // Big confetti celebration
      for (let i = 0; i < 100; i++) {
        setTimeout(() => createEnhancedConfetti(), i * 20);
      }
    }

    // Enhanced confetti with more particles and variety
    function createEnhancedConfetti() {
      const container = document.getElementById('confetti-container');
      const colors = ['#FB923C', '#EF4444', '#10B981', '#3B82F6', '#8B5CF6', '#EC4899', '#F59E0B', '#14B8A6'];
      const shapes = ['‚óè', '‚ñ†', '‚ñ≤', '‚òÖ', '‚ô•'];
      
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.fontSize = `${Math.random() * 20 + 15}px`;
        confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
        confetti.style.animationDelay = `${Math.random() * 0.5}s`;
        confetti.style.animationDuration = `${Math.random() * 1 + 1.5}s`;
        container.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 3000);
      }
    }

    // Start new round with improved randomness
    function startNewRound(config) {
      answered = false;
      questionCount++;
      currentNumber = getRandomNumber(); // Uses anti-repetition system
      
      const desktop = isDesktop();
      const feedbackEl = document.getElementById(desktop ? 'feedback-desktop' : 'feedback');
      const nextBtn = document.getElementById(desktop ? 'next-btn-desktop' : 'next-btn');
      const scoreEl = document.getElementById(desktop ? 'score-desktop' : 'score');
      const streakEl = document.getElementById(desktop ? 'streak-desktop' : 'streak');
      
      feedbackEl.innerHTML = '';
      nextBtn.classList.add('hidden');
      nextBtn.classList.remove('pulse-glow');
      
      // Remove animation classes
      scoreEl.classList.remove('pop');
      streakEl.classList.remove('pop', 'shake');
      
      // Update subtitle with question count
      const subtitleEl = document.getElementById(desktop ? 'subtitle-desktop' : 'subtitle');
      subtitleEl.textContent = `Question ${questionCount} of ${MAX_QUESTIONS}`;
      
      generateHandsForNumber(currentNumber);
      const options = generateOptions(currentNumber); // Always unique options
      renderOptions(options, config);
      startTimer();
    }

    // Apply config to UI
    async function onConfigChange(config) {
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      
      document.getElementById('app').style.backgroundColor = bgColor;
      
      // Mobile elements
      if (document.getElementById('hands-container')) {
        document.getElementById('hands-container').style.backgroundColor = surfaceColor;
        document.getElementById('hands-container').style.borderColor = primaryColor;
      }
      if (document.getElementById('game-title')) {
        document.getElementById('game-title').style.color = textColor;
        document.getElementById('game-title').textContent = config.game_title || defaultConfig.game_title;
      }
      if (document.getElementById('subtitle')) {
        document.getElementById('subtitle').style.color = textColor;
      }
      if (document.getElementById('timer-text')) {
        document.getElementById('timer-text').style.color = textColor;
      }
      if (document.getElementById('timer-container')) {
        document.getElementById('timer-container').style.backgroundColor = surfaceColor;
        document.getElementById('timer-container').style.borderColor = primaryColor;
      }
      if (document.getElementById('next-btn')) {
        const nextBtn = document.getElementById('next-btn');
        nextBtn.style.backgroundColor = primaryColor;
        nextBtn.style.color = surfaceColor;
        nextBtn.style.borderColor = textColor;
      }
      
      // Desktop elements
      if (document.getElementById('hands-container-desktop')) {
        document.getElementById('hands-container-desktop').style.backgroundColor = surfaceColor;
        document.getElementById('hands-container-desktop').style.borderColor = primaryColor;
      }
      if (document.getElementById('game-title-desktop')) {
        document.getElementById('game-title-desktop').style.color = textColor;
        document.getElementById('game-title-desktop').textContent = config.game_title || defaultConfig.game_title;
      }
      if (document.getElementById('subtitle-desktop')) {
        document.getElementById('subtitle-desktop').style.color = textColor;
      }
      if (document.getElementById('timer-text-desktop')) {
        document.getElementById('timer-text-desktop').style.color = textColor;
      }
      if (document.getElementById('timer-container-desktop')) {
        document.getElementById('timer-container-desktop').style.backgroundColor = surfaceColor;
        document.getElementById('timer-container-desktop').style.borderColor = primaryColor;
      }
      if (document.getElementById('next-btn-desktop')) {
        const nextBtnDesktop = document.getElementById('next-btn-desktop');
        nextBtnDesktop.style.backgroundColor = primaryColor;
        nextBtnDesktop.style.color = surfaceColor;
        nextBtnDesktop.style.borderColor = textColor;
      }
      
      // Score badges (both versions)
      document.querySelectorAll('.score-badge').forEach(el => {
        el.style.backgroundColor = surfaceColor;
        el.style.color = textColor;
        el.style.borderColor = primaryColor;
      });
    }

    // Initialize Element SDK
    window.elementSdk.init({
      defaultConfig,
      onConfigChange,
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => { config.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => { config.primary_action_color = value; window.elementSdk.setConfig({ primary_action_color: value }); }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => { config.secondary_action_color = value; window.elementSdk.setConfig({ secondary_action_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || 'Fredoka',
          set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
        },
        fontSizeable: {
          get: () => config.font_size || 16,
          set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
        }
      }),
      mapToEditPanelValues: (config) => new Map([
        ["game_title", config.game_title || defaultConfig.game_title],
        ["correct_message", config.correct_message || defaultConfig.correct_message],
        ["wrong_message", config.wrong_message || defaultConfig.wrong_message]
      ])
    });

    // Setup next button
    document.getElementById('next-btn').addEventListener('click', () => {
      const config = window.elementSdk?.config || defaultConfig;
      startNewRound(config);
    });
    
    document.getElementById('next-btn-desktop').addEventListener('click', () => {
      const config = window.elementSdk?.config || defaultConfig;
      startNewRound(config);
    });

    // Start first round
    const initialConfig = window.elementSdk?.config || defaultConfig;
    startNewRound(initialConfig);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bb57c4b6502b6ac',t:'MTc2Nzk3Nzk3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
